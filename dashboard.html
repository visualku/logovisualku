<!-- Tambahkan di bagian <head> -->
<script>
  // Debugging global
  window.addEventListener('error', (event) => {
    console.error("Global Error:", event.message);
  });
</script>

<!-- Tambahkan di bagian script Firebase -->
<script type="module">
  // ... kode sebelumnya ...

  onAuthStateChanged(auth, async (user) => {
    console.log("Debug: User state changed", user);
    
    if (user) {
      // User adalah admin/desainer
      loginBtn.textContent = 'Keluar';
      loginBtn.onclick = () => {
        signOut(auth).then(() => {
          window.location.href = 'index.html';
        });
      };
      
      if (user.email === "admin@visualku.com") {
        document.getElementById('adminTab').style.display = 'block';
        showTab('admin');
        loadAllContests();
        return;
      }
      
      // Cek desainer
      try {
        const usersQuery = query(collection(db, 'users'), where('uid', '==', user.uid));
        const userSnapshot = await getDocs(usersQuery);
        
        if (!userSnapshot.empty) {
          const userData = userSnapshot.docs[0].data();
          if (userData.role === 'designer') {
            document.getElementById('designerTab').style.display = 'block';
            showTab('designer');
            loadDesignerProfile(userData);
            loadDesignerContests();
            return;
          }
        }
      } catch (error) {
        console.error("Error fetching user data:", error);
      }
    }
    
    // Cek CH
    const chLoggedIn = sessionStorage.getItem('chLoggedIn');
    const chContestCode = sessionStorage.getItem('chContestCode');
    
    if (chLoggedIn && chContestCode) {
      loginBtn.textContent = 'Keluar';
      loginBtn.onclick = () => {
        sessionStorage.clear();
        window.location.href = 'index.html';
      };
      
      document.getElementById('chTab').style.display = 'block';
      showTab('ch');
      loadCHContest(chContestCode);
    } else {
      // Tidak ada yang login
      window.location.href = 'index.html';
    }
  });
</script>
