<!DOCTYPE html>
<html lang="id">
<head>
    <title>Dashboard - LogoVisualku</title>
</head>
<body>
    <div id="adminPanel" style="display:none;">
        <h3>Admin Panel</h3>
        <input type="text" id="codeInput" placeholder="Kode Kontes">
        <button onclick="verify()">Verifikasi</button>
        <div id="result"></div>
    </div>
    <div id="chPanel" style="display:none;">
        <h3>Kontes Saya</h3>
        <a href="buat-kontes.html">Buat Kontes Baru</a>
    </div>
    <div id="designerPanel" style="display:none;">
        <h3>Kontes yang Diikuti</h3>
        <a href="kontes.html">Lihat Kontes Aktif</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBmoIXKp8BABwBMqKKXhSUBLGnYSnKNAYg",
            authDomain: "logovisualku.firebaseapp.com",
            projectId: "logovisualku",
            storageBucket: "logovisualku.firebasestorage.app",
            messagingSenderId: "64489762880",
            appId: "1:64489762880:web:f55f26b068044f1320afa5"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                if (user.email === "admin@visualku.com") {
                    document.getElementById('adminPanel').style.display = 'block';
                } else {
                    const snapshot = await db.collection('users').where('uid', '==', user.uid).get();
                    if (!snapshot.empty) {
                        const role = snapshot.docs[0].data().role;
                        document.getElementById(`${role}Panel`).style.display = 'block';
                    }
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        window.verify = async () => {
            const code = document.getElementById('codeInput').value;
            const snapshot = await db.collection('contests').where('contestCode', '==', code).get();
            const result = document.getElementById('result');
            if (!snapshot.empty) {
                const doc = snapshot.docs[0];
                result.innerHTML = `<p>Kontes ditemukan: ${doc.data().businessName}. <button onclick="start('${doc.id}')">Mulai Kontes</button></p>`;
            } else {
                result.innerHTML = '<p>Kode tidak ditemukan</p>';
            }
        };

        window.start = async (id) => {
            const snapshot = await db.collection('contests').where('__name__', '==', id).get();
            if (!snapshot.empty) {
                await snapshot.docs[0].ref.update({ status: 'active' });
                alert('Kontes dimulai!');
            }
        };
    </script>
</body>
</html>
